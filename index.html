<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <meta name="darkreader-lock">
    <title>Icebreaker Bingo</title>
    <meta name="description" content="A fun icebreaker game — check off the squares that match you and see how many bingos you can get!">

    <!-- Open Graph (Facebook, LinkedIn, etc.) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://icebreakerbingo.com">
    <meta property="og:title" content="Icebreaker Bingo">
    <meta property="og:description" content="How many squares can you check off? Play Icebreaker Bingo and find out!">
    <meta property="og:image" content="https://icebreakerbingo.com/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter / X Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Icebreaker Bingo">
    <meta name="twitter:description" content="How many squares can you check off? Play Icebreaker Bingo and find out!">
    <meta name="twitter:image" content="https://icebreakerbingo.com/og-image.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://icebreakerbingo.com/">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Icebreaker Bingo",
        "url": "https://icebreakerbingo.com",
        "description": "A fun icebreaker game — check off the squares that match you and see how many bingos you can get!",
        "applicationCategory": "GameApplication",
        "genre": "Casual",
        "operatingSystem": "Any",
        "browserRequirements": "Requires a modern web browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "image": "https://icebreakerbingo.com/og-image.png",
        "screenshot": "https://icebreakerbingo.com/og-image.png",
        "author": {
            "@type": "Organization",
            "name": "Icebreaker Bingo"
        }
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;600;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Arctic palette */
            --bg-deep: #091832;
            --bg-mid: #0d2348;
            --aurora-cyan: rgba(56, 189, 248, 0.22);
            --aurora-purple: rgba(139, 92, 246, 0.18);
            --aurora-teal: rgba(45, 212, 191, 0.12);
            --aurora-accent1: rgba(56, 189, 248, 0.10);
            --aurora-accent2: rgba(139, 92, 246, 0.10);

            /* Ice tile colors */
            --ice-light: #d4e6f6;
            --ice-mid: #b3ced8;
            --ice-edge: #7ba6c9;
            --ice-border: rgba(255, 255, 255, 0.45);
            --ice-text: #152540;

            /* Tile gradient */
            --tile-from: #dae9f6;
            --tile-mid: #bdd4e8;
            --tile-to: #a8c4dc;

            /* Checked state */
            --checked-from: #14b8a6;
            --checked-mid: #8b5cf6;
            --checked-to: #6d28d9;
            --checked-span-from: #0f766e;
            --checked-span-to: #5b21b6;
            --checked-edge: #134e4a;
            --cracked-glow: rgba(45, 212, 191, 0.4);

            /* Center cell */
            --center-from: #fbbf24;
            --center-mid: #d97706;
            --center-to: #b45309;
            --center-edge: #92400e;
            --center-glow: rgba(251, 191, 36, 0.35);

            /* Gold (legacy alias) */
            --gold: #d97706;
            --gold-glow: rgba(251, 191, 36, 0.35);

            /* Title glow */
            --title-glow: rgba(56, 189, 248, 0.28);
            --title-glow-wide: rgba(56, 189, 248, 0.10);

            /* Board frame glow */
            --frame-glow: rgba(56, 189, 248, 0.06);

            /* UI surfaces */
            --frost-surface: rgba(255, 255, 255, 0.07);
            --frost-border: rgba(255, 255, 255, 0.10);
            --text-light: #e2e8f0;
            --text-bright: #ffffff;
            --text-dim: #94a3b8;
            --text-muted: #64748b;
            --focus-ring: #38bdf8;

            /* Shared */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --content-max: 560px;
            --sidebar-width: 300px;
        }

        /* ─── Work Theme: Slate/charcoal + amber accents ─── */
        body[data-visual-theme="work"] {
            --bg-deep: #141428;
            --bg-mid: #1c1c3a;
            --aurora-cyan: rgba(251, 191, 36, 0.20);
            --aurora-purple: rgba(168, 162, 200, 0.16);
            --aurora-teal: rgba(251, 146, 60, 0.14);
            --aurora-accent1: rgba(251, 191, 36, 0.10);
            --aurora-accent2: rgba(168, 162, 200, 0.08);
            --ice-light: #e2e4ea;
            --ice-mid: #c8cbd4;
            --ice-edge: #8891a0;
            --ice-border: rgba(255, 255, 255, 0.35);
            --ice-text: #1e293b;
            --tile-from: #e2e4ea;
            --tile-mid: #cdd1da;
            --tile-to: #b8bdc8;
            --checked-from: #f59e0b;
            --checked-mid: #3b82f6;
            --checked-to: #1e3a8a;
            --checked-span-from: #b45309;
            --checked-span-to: #1e40af;
            --checked-edge: #78350f;
            --cracked-glow: rgba(251, 191, 36, 0.35);
            --center-from: #f59e0b;
            --center-mid: #d97706;
            --center-to: #92400e;
            --center-edge: #78350f;
            --center-glow: rgba(245, 158, 11, 0.35);
            --title-glow: rgba(251, 191, 36, 0.28);
            --title-glow-wide: rgba(251, 191, 36, 0.10);
            --frame-glow: rgba(251, 191, 36, 0.06);
            --focus-ring: #f59e0b;
        }

        /* ─── Friends Theme: Vibrant purple/magenta ─── */
        body[data-visual-theme="friends"] {
            --bg-deep: #1e0838;
            --bg-mid: #2c0e52;
            --aurora-cyan: rgba(217, 70, 239, 0.24);
            --aurora-purple: rgba(139, 92, 246, 0.22);
            --aurora-teal: rgba(236, 72, 153, 0.16);
            --aurora-accent1: rgba(217, 70, 239, 0.12);
            --aurora-accent2: rgba(6, 182, 212, 0.10);
            --ice-light: #ede5f7;
            --ice-mid: #d8c8f0;
            --ice-edge: #a78bda;
            --ice-border: rgba(255, 255, 255, 0.40);
            --ice-text: #1e1040;
            --tile-from: #ede5f7;
            --tile-mid: #ddd0f2;
            --tile-to: #ccb8ec;
            --checked-from: #d946ef;
            --checked-mid: #06b6d4;
            --checked-to: #0e7490;
            --checked-span-from: #a21caf;
            --checked-span-to: #0891b2;
            --checked-edge: #701a75;
            --cracked-glow: rgba(217, 70, 239, 0.4);
            --center-from: #f472b6;
            --center-mid: #ec4899;
            --center-to: #be185d;
            --center-edge: #9d174d;
            --center-glow: rgba(236, 72, 153, 0.4);
            --title-glow: rgba(217, 70, 239, 0.28);
            --title-glow-wide: rgba(217, 70, 239, 0.10);
            --frame-glow: rgba(217, 70, 239, 0.06);
            --focus-ring: #d946ef;
        }

        /* ─── Family Theme: Cheerful primary colors ─── */
        body[data-visual-theme="family"] {
            --bg-deep: #0a1838;
            --bg-mid: #10224e;
            --aurora-cyan: rgba(59, 130, 246, 0.24);
            --aurora-purple: rgba(251, 191, 36, 0.20);
            --aurora-teal: rgba(34, 197, 94, 0.14);
            --aurora-accent1: rgba(59, 130, 246, 0.12);
            --aurora-accent2: rgba(251, 191, 36, 0.10);
            --ice-light: #e0ecf8;
            --ice-mid: #c8d9ee;
            --ice-edge: #7da3cc;
            --ice-border: rgba(255, 255, 255, 0.40);
            --ice-text: #1a2744;
            --tile-from: #e4edf8;
            --tile-mid: #d2e0f0;
            --tile-to: #bdd0e6;
            --checked-from: #3b82f6;
            --checked-mid: #eab308;
            --checked-to: #16a34a;
            --checked-span-from: #1d4ed8;
            --checked-span-to: #15803d;
            --checked-edge: #1e3a5f;
            --cracked-glow: rgba(59, 130, 246, 0.35);
            --center-from: #fbbf24;
            --center-mid: #eab308;
            --center-to: #a16207;
            --center-edge: #854d0e;
            --center-glow: rgba(234, 179, 8, 0.4);
            --title-glow: rgba(59, 130, 246, 0.28);
            --title-glow-wide: rgba(59, 130, 246, 0.10);
            --frame-glow: rgba(59, 130, 246, 0.06);
            --focus-ring: #3b82f6;
        }

        /* ─── First Date Theme: Soft rose/blush ─── */
        body[data-visual-theme="dating"] {
            --bg-deep: #30082a;
            --bg-mid: #461040;
            --aurora-cyan: rgba(244, 114, 182, 0.24);
            --aurora-purple: rgba(232, 121, 249, 0.18);
            --aurora-teal: rgba(251, 191, 36, 0.12);
            --aurora-accent1: rgba(244, 114, 182, 0.12);
            --aurora-accent2: rgba(232, 121, 249, 0.10);
            --ice-light: #f5e0ea;
            --ice-mid: #eacbd8;
            --ice-edge: #c48da6;
            --ice-border: rgba(255, 255, 255, 0.38);
            --ice-text: #3b0820;
            --tile-from: #f5e0ea;
            --tile-mid: #eed2e0;
            --tile-to: #e4bfd2;
            --checked-from: #f472b6;
            --checked-mid: #c084fc;
            --checked-to: #7c3aed;
            --checked-span-from: #db2777;
            --checked-span-to: #6d28d9;
            --checked-edge: #9d174d;
            --cracked-glow: rgba(244, 114, 182, 0.4);
            --center-from: #fda4af;
            --center-mid: #f472b6;
            --center-to: #db2777;
            --center-edge: #9d174d;
            --center-glow: rgba(244, 114, 182, 0.4);
            --title-glow: rgba(244, 114, 182, 0.28);
            --title-glow-wide: rgba(244, 114, 182, 0.10);
            --frame-glow: rgba(244, 114, 182, 0.06);
            --focus-ring: #f472b6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            background: var(--bg-deep);
            background-image:
                radial-gradient(ellipse at 30% 10%, var(--aurora-cyan) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 20%, var(--aurora-purple) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, var(--aurora-teal) 0%, transparent 50%),
                radial-gradient(ellipse at 15% 90%, var(--aurora-accent1) 0%, transparent 40%),
                radial-gradient(ellipse at 85% 60%, var(--aurora-accent2) 0%, transparent 40%);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* ─── Skip Link (WCAG 2.4.1) ─── */
        .skip-link {
            position: absolute;
            top: -100%;
            left: 16px;
            z-index: 2000;
            background: var(--focus-ring);
            color: var(--bg-deep);
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 4px 20px rgba(56, 189, 248, 0.4);
        }

        .skip-link:focus {
            top: 16px;
            outline: 3px solid var(--text-bright);
            outline-offset: 2px;
        }

        /* ─── Global Focus (WCAG 2.4.7) ─── */
        :focus-visible {
            outline: 3px solid var(--focus-ring);
            outline-offset: 2px;
        }

        /* ─── Toast Notification ─── */
        .share-toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(15, 23, 42, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e2e8f0;
            font-family: Inter, system-ui, sans-serif;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(148, 163, 184, 0.08);
            z-index: 10000;
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
            pointer-events: none;
        }
        .share-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .share-toast .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        @media (prefers-reduced-motion: reduce) {
            .share-toast {
                transition: opacity 0.2s ease;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ─── Share Panel Overlay ─── */
        .share-overlay {
            position: fixed;
            inset: 0;
            z-index: 9000;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 18, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .share-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .share-panel {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(148, 163, 184, 0.15);
            border-radius: 20px;
            padding: 32px 28px 28px;
            max-width: 400px;
            width: 90vw;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(148, 163, 184, 0.06);
            transform: translateY(24px) scale(0.96);
            transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }
        .share-overlay.active .share-panel {
            transform: translateY(0) scale(1);
        }

        .share-panel-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            line-height: 1;
        }
        .share-panel-close:hover {
            background: rgba(255, 255, 255, 0.12);
            color: var(--text-bright);
        }

        .share-panel-title {
            font-family: Fredoka, Inter, system-ui, sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-bright);
            text-align: center;
            margin: 0 0 6px;
        }

        .share-panel-hint {
            font-size: 0.82rem;
            color: var(--text-muted);
            text-align: center;
            margin: 0 0 24px;
            line-height: 1.4;
        }
        .share-panel-hint .hint-icon {
            color: #34d399;
        }
        .share-panel-hint .wave-char {
            display: inline-block;
            color: var(--text-muted);
        }
        .share-panel-hint.has-image .wave-char {
            animation: hintWave 6s ease-in-out infinite;
        }
        @keyframes hintWave {
            0%, 100% { color: var(--text-muted); transform: translateY(0); }
            8% { color: #34d399; transform: translateY(-3px); }
            16% { color: var(--text-muted); transform: translateY(0); }
        }

        /* Platform button grid */
        .share-platforms {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .platform-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 10px 10px;
            width: 68px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        .platform-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.18);
            transform: translateY(-2px);
        }
        .platform-btn:active {
            transform: translateY(0);
        }
        .platform-btn svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }
        .platform-btn .platform-label {
            font-family: Inter, system-ui, sans-serif;
            font-size: 0.65rem;
            font-weight: 500;
            color: var(--text-muted);
            white-space: nowrap;
        }

        /* Brand hover colors */
        .platform-btn[data-platform="x"]:hover { border-color: #a8a8a8; box-shadow: 0 4px 16px rgba(168, 168, 168, 0.15); }
        .platform-btn[data-platform="facebook"]:hover { border-color: #1877F2; box-shadow: 0 4px 16px rgba(24, 119, 242, 0.2); }
        .platform-btn[data-platform="whatsapp"]:hover { border-color: #25D366; box-shadow: 0 4px 16px rgba(37, 211, 102, 0.2); }
        .platform-btn[data-platform="email"]:hover { border-color: #f59e0b; box-shadow: 0 4px 16px rgba(245, 158, 11, 0.15); }

        /* Secondary actions row */
        .share-secondary {
            display: flex;
            gap: 10px;
        }
        .share-secondary button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-family: Inter, system-ui, sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .share-secondary button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--text-bright);
        }
        .share-secondary button svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        @media (prefers-reduced-motion: reduce) {
            .share-overlay { transition: opacity 0.15s ease, visibility 0.15s ease; }
            .share-panel { transition: none; transform: none; }
            .platform-btn { transition: none; }
            .platform-btn:hover { transform: none; }
        }

        /* ─── Decorative Snowflakes ─── */
        .snowflakes {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            top: -6%;
            font-size: 1rem;
            animation: snowfall linear infinite, snowsway ease-in-out infinite;
            user-select: none;
            filter: blur(0px);
        }

        /* nth-child styles removed — particles are built dynamically by JS */

        @keyframes snowfall {
            0%   { transform: translateY(-5vh) rotate(0deg);   opacity: 0; }
            8%   { opacity: 1; }
            85%  { opacity: 1; }
            100% { transform: translateY(108vh) rotate(720deg); opacity: 0; }
        }

        @keyframes snowsway {
            0%, 100% { margin-left: 0; }
            25%      { margin-left: 30px; }
            75%      { margin-left: -30px; }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.4; text-shadow: 0 0 0 transparent; }
            50%      { opacity: 1;   text-shadow: 0 0 8px currentColor, 0 0 16px currentColor; }
        }

        /* ─── Top Leaderboard Ad ─── */
        .ad-leaderboard {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 8px 16px 0;
            position: relative;
            z-index: 1;
        }

        .ad-leaderboard .ad-slot {
            width: 728px;
            max-width: 100%;
            height: 90px;
        }

        /* ─── Page Layout ─── */
        .page-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 24px;
            width: 100%;
            max-width: 1200px;
            padding: 12px 16px 20px;
            position: relative;
            z-index: 1;
        }

        /* ─── Sidebar Ads ─── */
        .ad-sidebar {
            flex-shrink: 0;
            width: var(--sidebar-width);
            position: sticky;
            top: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .ad-sidebar .ad-slot {
            width: var(--sidebar-width);
            height: 250px;
        }

        /* ─── Ad Slot Base ─── */
        .ad-slot {
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            font-size: 0.8rem;
        }

        /* ─── Main Content ─── */
        .main-content {
            flex: 1;
            max-width: var(--content-max);
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        /* ─── Header ─── */
        .header {
            text-align: center;
            padding-top: 4px;
        }

        .header h1 {
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 2.6rem;
            font-weight: 700;
            color: var(--text-bright);
            line-height: 1.1;
            text-shadow:
                0 0 16px var(--title-glow),
                0 0 40px var(--title-glow-wide),
                0 2px 0 rgba(0, 0, 0, 0.25);
            letter-spacing: -0.01em;
        }

        .header p {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-top: 6px;
            font-weight: 500;
        }

        /* ─── Stats Bar (Game HUD) ─── */
        .stats-bar {
            display: flex;
            gap: 2px;
            background: var(--frost-surface);
            border: 1px solid var(--frost-border);
            padding: 4px;
            border-radius: var(--radius-lg);
            box-shadow:
                0 4px 24px rgba(0, 0, 0, 0.2),
                inset 0 1px 1px rgba(255, 255, 255, 0.05);
            width: 100%;
            max-width: 300px;
        }

        .stat-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            transition: background var(--transition);
        }

        .stat-item:hover {
            background: rgba(56, 189, 248, 0.06);
        }

        .stat-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .stat-value {
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--focus-ring);
            line-height: 1.2;
            text-shadow: 0 0 12px rgba(56, 189, 248, 0.3);
        }

        /* ─── Reset Button (below board) ─── */
        .reset-btn {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.55rem 1.5rem;
            background: var(--frost-surface);
            border: 1px solid var(--frost-border);
            border-radius: 50px;
            color: var(--text-light);
            cursor: pointer;
            transition: all var(--transition);
            box-shadow:
                0 3px 0 rgba(255, 255, 255, 0.04),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .reset-btn svg {
            width: 14px;
            height: 14px;
        }

        .reset-btn:hover {
            background: rgba(56, 189, 248, 0.12);
            border-color: rgba(56, 189, 248, 0.25);
            color: var(--text-bright);
            box-shadow:
                0 3px 0 rgba(255, 255, 255, 0.04),
                0 6px 18px rgba(0, 0, 0, 0.25);
            transform: translateY(-1px);
        }

        .reset-btn:active {
            transform: translateY(1px);
            box-shadow:
                0 1px 0 rgba(255, 255, 255, 0.04),
                0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .reset-btn:focus-visible {
            outline: 3px solid var(--focus-ring);
            outline-offset: 2px;
        }

        /* ─── Sound Toggle ─── */
        .sound-toggle {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--frost-surface);
            border: 1px solid var(--frost-border);
            color: var(--text-dim);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition);
            z-index: 5;
        }
        .sound-toggle:hover {
            background: rgba(56, 189, 248, 0.12);
            color: var(--text-bright);
        }
        .sound-toggle svg { width: 18px; height: 18px; }
        .sound-toggle .icon-on { display: none; }
        .sound-toggle .icon-off { display: block; }
        .sound-toggle.active .icon-on { display: block; }
        .sound-toggle.active .icon-off { display: none; }

        /* ─── Achievement Toast ─── */
        .achievement-toast {
            position: fixed;
            top: 18px;
            left: 50%;
            transform: translateX(-50%) translateY(-120px);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 22px 10px 16px;
            border-radius: 50px;
            background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
            border: 1px solid rgba(255,255,255,0.18);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            box-shadow:
                0 8px 32px rgba(0,0,0,0.35),
                0 0 20px var(--frame-glow);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease;
        }
        .achievement-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        .achievement-toast .ach-icon {
            font-size: 1.3rem;
            line-height: 1;
            flex-shrink: 0;
        }
        .achievement-toast .ach-body {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        .achievement-toast .ach-label {
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-dim);
        }
        .achievement-toast .ach-title {
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--focus-ring);
            white-space: nowrap;
        }

        /* ─── Theme Picker ─── */
        .theme-picker {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .theme-btn {
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 0.72rem;
            font-weight: 600;
            padding: 5px 12px;
            border-radius: 50px;
            background: var(--frost-surface);
            border: 1px solid var(--frost-border);
            color: var(--text-dim);
            cursor: pointer;
            transition: all var(--transition);
        }
        .theme-btn:hover {
            background: rgba(56, 189, 248, 0.1);
            color: var(--text-light);
        }
        .theme-btn.active {
            background: rgba(56, 189, 248, 0.18);
            border-color: rgba(56, 189, 248, 0.35);
            color: var(--text-bright);
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.15);
        }
        .daily-badge {
            display: inline-block;
            font-size: 0.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #0b1628;
            padding: 1px 6px;
            border-radius: 50px;
            margin-left: 4px;
            vertical-align: middle;
        }

        /* ─── Board Actions Row ─── */
        .board-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* ─── Share Button ─── */
        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.55rem 1.5rem;
            background: var(--frost-surface);
            border: 1px solid var(--frost-border);
            border-radius: 50px;
            color: var(--text-light);
            cursor: pointer;
            transition: all var(--transition);
            box-shadow:
                0 3px 0 rgba(255, 255, 255, 0.04),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .share-btn svg {
            width: 14px;
            height: 14px;
        }

        .share-btn:hover {
            background: rgba(56, 189, 248, 0.12);
            border-color: rgba(56, 189, 248, 0.25);
            color: var(--text-bright);
            box-shadow:
                0 3px 0 rgba(255, 255, 255, 0.04),
                0 6px 18px rgba(0, 0, 0, 0.25);
            transform: translateY(-1px);
        }

        .share-btn:active {
            transform: translateY(1px);
            box-shadow:
                0 1px 0 rgba(255, 255, 255, 0.04),
                0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .share-btn:focus-visible {
            outline: 3px solid var(--focus-ring);
            outline-offset: 2px;
        }

        /* ─── Overlay Actions Row ─── */
        .overlay-actions {
            display: flex;
            gap: 12px;
            align-items: stretch;
            justify-content: center;
            width: 100%;
        }

        .overlay-actions button {
            flex: 1;
            min-width: 0;
        }

        .overlay-share-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            font-size: 1rem;
            padding: 0.75rem 1.8rem;
            box-shadow:
                0 3px 0 rgba(255, 255, 255, 0.04),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .overlay-share-btn:hover {
            background: rgba(255, 255, 255, 0.14);
            border-color: rgba(255, 255, 255, 0.25);
            color: var(--text-bright);
        }

        /* ─── Board Frame ─── */
        .board-frame {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-xl);
            padding: 14px;
            box-shadow:
                0 0 60px var(--frame-glow),
                inset 0 1px 1px rgba(255, 255, 255, 0.04);
            width: 100%;
            overflow: hidden;
        }

        /* ─── Bingo Grid ─── */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 7px;
            width: 100%;
        }

        /* ─── Ice Tile Cells ─── */
        .grid-cell {
            aspect-ratio: 1;
            background: linear-gradient(155deg, var(--tile-from) 0%, var(--tile-mid) 60%, var(--tile-to) 100%);
            border: 1px solid var(--ice-border);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            text-align: center;
            font-size: 0.74rem;
            font-weight: 600;
            line-height: 1.25;
            cursor: pointer;
            transition: transform var(--transition), box-shadow var(--transition);
            box-shadow:
                0 4px 0 var(--ice-edge),
                0 6px 14px rgba(0, 0, 0, 0.25),
                inset 0 2px 3px rgba(255, 255, 255, 0.7);
            position: relative;
            overflow: hidden;
            color: var(--ice-text);
        }

        .grid-cell:hover {
            transform: translateY(-3px);
            box-shadow:
                0 7px 0 var(--ice-edge),
                0 10px 24px rgba(0, 0, 0, 0.3),
                inset 0 2px 3px rgba(255, 255, 255, 0.7);
        }

        .grid-cell:active {
            transform: translateY(2px);
            box-shadow:
                0 1px 0 var(--ice-edge),
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 3px rgba(255, 255, 255, 0.5);
        }

        /* Focus ring on label when child input is focused (WCAG 2.4.7) */
        .grid-cell:focus-within {
            outline: 3px solid var(--focus-ring);
            outline-offset: 2px;
        }

        .grid-cell input {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 6;
        }

        .grid-cell input:focus-visible {
            outline: none;
        }

        .grid-cell span {
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            word-wrap: break-word;
            overflow: hidden;
            border-radius: calc(var(--radius-md) - 3px);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 2px;
        }

        /* ── Checked = Cracked ice revealing aurora beneath ── */
        .grid-cell:has(input:checked) {
            box-shadow:
                0 4px 0 var(--checked-edge),
                0 6px 14px rgba(0, 0, 0, 0.3),
                0 0 22px var(--cracked-glow),
                inset 0 2px 3px rgba(255, 255, 255, 0.15);
            background: linear-gradient(155deg, var(--checked-from) 0%, var(--checked-mid) 50%, var(--checked-to) 100%);
        }

        .grid-cell input:checked + span {
            background: linear-gradient(135deg, var(--checked-span-from) 0%, var(--checked-span-to) 100%);
            color: var(--text-bright);
            font-weight: 700;
            animation: iceBreak 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /*
         * WCAG 1.4.1 (Use of Color): checked state is conveyed by
         * the crack-line texture overlay, aurora gradient background,
         * and the 3D depth-shadow shift — not color alone.
         */

        /* ── Ice-crack overlay on checked cells ── */
        .grid-cell:has(input:checked)::after {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 4;
            pointer-events: none;
            border-radius: inherit;
            background:
                /* Main diagonal crack */
                linear-gradient(130deg,
                    transparent 36%, rgba(255,255,255,0.55) 36%, rgba(255,255,255,0.55) 36.5%, transparent 36.5%,
                    transparent 63%, rgba(255,255,255,0.40) 63%, rgba(255,255,255,0.40) 63.5%, transparent 63.5%),
                /* Branch crack upper-right */
                linear-gradient(68deg,
                    transparent 42%, rgba(255,255,255,0.35) 42%, rgba(255,255,255,0.35) 42.4%, transparent 42.4%),
                /* Branch crack lower-left */
                linear-gradient(172deg,
                    transparent 52%, rgba(255,255,255,0.30) 52%, rgba(255,255,255,0.30) 52.4%, transparent 52.4%),
                /* Small fracture spur */
                linear-gradient(30deg,
                    transparent 69%, rgba(255,255,255,0.25) 69%, rgba(255,255,255,0.25) 69.3%, transparent 69.3%),
                /* Micro fracture */
                linear-gradient(95deg,
                    transparent 28%, rgba(255,255,255,0.20) 28%, rgba(255,255,255,0.20) 28.3%, transparent 28.3%);
            animation: cracksReveal 0.5s ease-out forwards;
        }

        /* ── Impact flash on checked cells ── */
        .grid-cell:has(input:checked)::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 5;
            pointer-events: none;
            border-radius: inherit;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.85) 0%, rgba(200, 230, 255, 0.35) 35%, transparent 65%);
            animation: iceFlash 0.45s ease-out forwards;
        }

        /* ── Ice Shard Particles ── */
        .ice-shard {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            background: linear-gradient(135deg, rgba(218, 233, 246, 0.95), rgba(168, 196, 220, 0.8));
            clip-path: polygon(15% 0%, 85% 5%, 100% 55%, 75% 100%, 5% 80%);
            box-shadow: 0 0 4px rgba(200, 225, 255, 0.6);
            animation: shardFly 0.65s ease-out forwards;
        }

        /* Alternate shard shape */
        .ice-shard:nth-child(odd) {
            clip-path: polygon(50% 0%, 95% 30%, 80% 100%, 10% 85%, 0% 20%);
        }

        /* ── Gold Star Center Cell ── */
        .center-cell {
            background: linear-gradient(155deg, var(--center-from) 0%, var(--center-mid) 40%, var(--center-to) 100%) !important;
            border: 1px solid rgba(255, 255, 255, 0.35) !important;
            color: var(--text-bright);
            box-shadow:
                0 4px 0 var(--center-edge),
                0 6px 14px rgba(0, 0, 0, 0.3),
                0 0 28px var(--center-glow),
                inset 0 2px 4px rgba(255, 255, 255, 0.35) !important;
            animation: goldPulse 3s ease-in-out infinite;
        }

        .center-cell:hover {
            transform: translateY(-3px);
            box-shadow:
                0 7px 0 var(--center-edge),
                0 10px 24px rgba(0, 0, 0, 0.35),
                0 0 40px var(--center-glow),
                inset 0 2px 4px rgba(255, 255, 255, 0.35) !important;
        }

        /* 3D gold star */
        .center-cell .star-3d {
            width: 55%;
            height: 55%;
            position: relative;
            /* filter set inline by JS per theme */
        }

        /* Base star shape — golden gradient with metallic sheen */
        .center-cell .star-3d .star-base {
            fill: url(#goldGradient);
        }

        /* Highlight facet — lighter top-left for 3D bevel */
        .center-cell .star-3d .star-highlight {
            fill: url(#goldHighlight);
            opacity: 0.6;
        }

        /* ─── Bottom Ad (mobile) ─── */
        .ad-bottom {
            display: none;
            width: 100%;
            padding: 0 16px 16px;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .ad-bottom .ad-slot {
            width: 100%;
            max-width: 728px;
            height: 60px;
        }

        /* ─── Footer ─── */
        .footer {
            text-align: center;
            padding: 12px 16px 20px;
            font-size: 0.8rem;
            color: var(--text-dim);
            position: relative;
            z-index: 1;
        }

        /* ─── Animations ─── */
        @keyframes iceBreak {
            0%   { transform: scale(1) rotate(0deg); }
            12%  { transform: scale(1.08) rotate(-1.5deg); }
            24%  { transform: scale(0.96) rotate(1deg); }
            36%  { transform: scale(1.04) rotate(-0.5deg); }
            50%  { transform: scale(0.98) rotate(0.3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes cracksReveal {
            0%   { opacity: 0; clip-path: circle(0% at 50% 50%); }
            40%  { opacity: 1; }
            100% { opacity: 1; clip-path: circle(100% at 50% 50%); }
        }

        @keyframes iceFlash {
            0%   { opacity: 1; transform: scale(0.3); }
            100% { opacity: 0; transform: scale(1.2); }
        }

        @keyframes shardFly {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--shard-dx), var(--shard-dy)) rotate(var(--shard-rot)) scale(0.2);
                opacity: 0;
            }
        }

        @keyframes goldPulse {
            0%, 100% { box-shadow:
                0 4px 0 #92400e,
                0 6px 14px rgba(0, 0, 0, 0.3),
                0 0 28px rgba(251, 191, 36, 0.35),
                inset 0 2px 4px rgba(255, 255, 255, 0.35);
            }
            50% { box-shadow:
                0 4px 0 #92400e,
                0 6px 14px rgba(0, 0, 0, 0.3),
                0 0 44px rgba(251, 191, 36, 0.55),
                inset 0 2px 4px rgba(255, 255, 255, 0.35);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(24px) scale(0.95); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes celebrateBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25%  { transform: scale(1.15) rotate(-3deg); }
            50%  { transform: scale(1.05) rotate(2deg); }
            75%  { transform: scale(1.1) rotate(-1deg); }
        }

        @keyframes sparklefall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 0.8; }
            100% {
                transform: translateY(110vh) rotate(540deg);
                opacity: 0;
            }
        }

        /* ─── Reduced Motion (WCAG 2.3.3) ─── */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .snowflakes {
                display: none;
            }
        }

        /* ─── Celebration Overlay ─── */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(11, 22, 40, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .overlay-card {
            background: linear-gradient(165deg, #1e3a5f 0%, #0f1f3d 100%);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: var(--radius-xl);
            padding: 2.5rem 3rem;
            text-align: center;
            box-shadow:
                0 8px 40px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(56, 189, 248, 0.1);
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 400px;
            width: 90%;
        }

        .overlay-card .trophy {
            font-size: 4rem;
            line-height: 1;
            margin-bottom: 0.75rem;
            animation: celebrateBounce 1.5s ease-in-out infinite;
        }

        .overlay-card h2 {
            font-family: 'Fredoka', 'Inter', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-bright);
            margin-bottom: 0.5rem;
            text-shadow: 0 0 24px rgba(56, 189, 248, 0.4);
        }

        .overlay-card p {
            font-size: 1rem;
            color: var(--text-dim);
            margin-bottom: 1.75rem;
            line-height: 1.5;
        }

        .overlay-card button {
            font-family: 'Fredoka', 'Inter', sans-serif;
            padding: 0.85rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--focus-ring), #0ea5e9);
            color: var(--bg-deep);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow:
                0 4px 0 #0369a1,
                0 6px 20px rgba(56, 189, 248, 0.35);
        }

        .overlay-card button:hover {
            transform: translateY(-2px);
            box-shadow:
                0 6px 0 #0369a1,
                0 10px 30px rgba(56, 189, 248, 0.45);
        }

        .overlay-card button:focus-visible {
            outline: 3px solid var(--text-bright);
            outline-offset: 2px;
        }

        .overlay-card button:active {
            transform: translateY(2px);
            box-shadow:
                0 1px 0 #0369a1,
                0 2px 8px rgba(56, 189, 248, 0.25);
        }

        /* ─── Blackout Celebration ─── */
        .overlay.blackout .overlay-card {
            background: linear-gradient(165deg, #1a1040 0%, #0a0520 100%);
            border-color: rgba(251, 191, 36, 0.3);
            box-shadow:
                0 0 60px rgba(251, 191, 36, 0.15),
                0 25px 60px rgba(0, 0, 0, 0.5);
        }
        .overlay.blackout .overlay-card .trophy {
            font-size: 5rem;
            animation: blackoutStar 1.5s ease-in-out infinite;
        }
        .overlay.blackout .overlay-card h2 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #fde68a, #f59e0b);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: goldShimmer 2s linear infinite;
            text-shadow: none;
        }
        .overlay.blackout .overlay-card p {
            color: var(--text-light);
        }
        @keyframes blackoutStar {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(1) rotate(0deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
        }
        @keyframes goldShimmer {
            0% { background-position: 100% 50%; }
            100% { background-position: -100% 50%; }
        }

        /* ─── Celebration Particles (Sparkles) ─── */
        .particle {
            position: fixed;
            pointer-events: none;
            animation: sparklefall linear forwards;
            z-index: 1001;
        }

        /* ─── Responsive: Hide sidebars ─── */
        @media (max-width: 1080px) {
            .ad-sidebar {
                display: none;
            }

            .page-wrapper {
                max-width: var(--content-max);
            }

            .ad-bottom {
                display: flex;
            }
        }

        /* ─── Responsive: Tablet ─── */
        @media (max-width: 640px) {
            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 0.82rem;
            }

            .stats-bar {
                max-width: 260px;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .grid-container {
                gap: 5px;
            }

            .grid-cell {
                font-size: 0.65rem;
                padding: 4px;
                border-radius: var(--radius-sm);
            }

            .grid-cell span {
                border-radius: calc(var(--radius-sm) - 2px);
            }

            .board-frame {
                padding: 10px;
                border-radius: var(--radius-lg);
            }

            .ad-leaderboard .ad-slot {
                height: 60px;
            }

            .ad-bottom .ad-slot {
                height: 50px;
            }

            .overlay-card {
                padding: 2rem;
            }

            .overlay-card .trophy {
                font-size: 3rem;
            }

            .overlay-card h2 {
                font-size: 1.6rem;
            }

            .overlay-card p {
                font-size: 0.9rem;
            }

            .overlay-card button {
                padding: 0.75rem 2rem;
                font-size: 1rem;
            }
        }

        /* ─── Responsive: Small phones ─── */
        @media (max-width: 380px) {
            .header h1 {
                font-size: 1.7rem;
            }

            .grid-cell {
                font-size: 0.6rem;
                padding: 3px;
                box-shadow:
                    0 3px 0 var(--ice-edge),
                    0 4px 8px rgba(0, 0, 0, 0.25),
                    inset 0 1px 2px rgba(255, 255, 255, 0.6);
            }

            .stats-bar {
                max-width: 220px;
            }

            .board-frame {
                padding: 8px;
            }

            .grid-container {
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Navigation (WCAG 2.4.1) -->
    <a href="#bingo-game" class="skip-link">Skip to game board</a>

    <!-- Decorative floating snowflakes -->
    <div class="snowflakes" id="particleContainer" aria-hidden="true"></div>

    <!-- Top Leaderboard Ad -->
    <div class="ad-leaderboard" role="complementary" aria-label="Advertisement">
        <div class="ad-slot" id="adLeaderboard">Ad Space &mdash; 728 &times; 90</div>
    </div>

    <div class="page-wrapper">
        <!-- Left Sidebar Ad -->
        <aside class="ad-sidebar ad-sidebar-left" aria-label="Left advertisement">
            <div class="ad-slot" id="adSidebarLeft">Ad Space &mdash; 300 &times; 250</div>
        </aside>

        <!-- Main Game Content -->
        <main class="main-content" id="bingo-game" tabindex="-1" style="position:relative;">
            <button class="sound-toggle" id="soundToggle" aria-label="Toggle sound" title="Toggle sound">
                <svg class="icon-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                <svg class="icon-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>
            </button>
            <header class="header">
                <h1>Icebreaker Bingo</h1>
                <p>Check every square that sounds like you, then share it!</p>
            </header>

            <div class="theme-picker" id="themePicker" aria-label="Choose a theme"></div>

            <div class="stats-bar" role="status" aria-live="polite" aria-atomic="true" aria-label="Game statistics">
                <div class="stat-item">
                    <span class="stat-label" id="checkedLabel">Checked</span>
                    <span class="stat-value" id="checkedCount" aria-labelledby="checkedLabel">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label" id="bingosLabel">Bingos</span>
                    <span class="stat-value" id="winsCount" aria-labelledby="bingosLabel">0</span>
                </div>
            </div>

            <section class="board-frame">
                <div class="grid-container" id="gridContainer" role="grid" aria-label="Bingo board"></div>
            </section>

            <div class="board-actions">
                <button class="reset-btn" id="resetBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                    </svg>
                    New Board
                </button>
                <button class="share-btn" id="shareBtn" aria-label="Share board image">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    Share
                </button>
            </div>
        </main>

        <!-- Right Sidebar Ad -->
        <aside class="ad-sidebar ad-sidebar-right" aria-label="Right advertisement">
            <div class="ad-slot" id="adSidebarRight">Ad Space &mdash; 300 &times; 250</div>
        </aside>
    </div>

    <!-- Bottom Ad (visible when sidebars are hidden) -->
    <div class="ad-bottom" role="complementary" aria-label="Advertisement">
        <div class="ad-slot" id="adBottom">Ad Space &mdash; 728 &times; 90</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- Celebration Overlay -->
    <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="overlayTitle" aria-describedby="overlayDesc">
        <div class="overlay-card">
            <div class="trophy" role="img" aria-hidden="true">&#127881;</div>
            <h2 id="overlayTitle">Bingo!</h2>
            <p id="overlayDesc">You broke the ice! Spread the fun — share your board.</p>
            <div class="overlay-actions">
                <button id="newBoardBtn">Keep Playing</button>
                <button class="share-btn overlay-share-btn" id="overlayShareBtn" aria-label="Share board image">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    Share
                </button>
            </div>
        </div>
    </div>

    <!-- Share Panel Overlay -->
    <div class="share-overlay" id="shareOverlay" aria-hidden="true">
        <div class="share-panel" role="dialog" aria-modal="true" aria-labelledby="sharePanelTitle">
            <button class="share-panel-close" id="sharePanelClose" aria-label="Close share panel">&times;</button>
            <h3 class="share-panel-title" id="sharePanelTitle">Share Your Board</h3>
            <p class="share-panel-hint" id="sharePanelHint">
                <span class="hint-icon">&#10003;</span> Image copied to clipboard &mdash; paste it in your post!
            </p>
            <div class="share-platforms">
                <!-- X / Twitter -->
                <button class="platform-btn" data-platform="x" aria-label="Share on X">
                    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    <span class="platform-label">X</span>
                </button>
                <!-- Facebook -->
                <button class="platform-btn" data-platform="facebook" aria-label="Share on Facebook">
                    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                    <span class="platform-label">Facebook</span>
                </button>
                <!-- WhatsApp -->
                <button class="platform-btn" data-platform="whatsapp" aria-label="Share on WhatsApp">
                    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    <span class="platform-label">WhatsApp</span>
                </button>
                <!-- Email -->
                <button class="platform-btn" data-platform="email" aria-label="Share via Email">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                    <span class="platform-label">Email</span>
                </button>
            </div>
            <div class="share-secondary">
                <button id="shareCopyBtn" aria-label="Copy image to clipboard">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy Image
                </button>
                <button id="shareDownloadBtn" aria-label="Download board image">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Download
                </button>
                <button id="shareLinkBtn" aria-label="Copy challenge link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                    Copy Link
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <!-- Achievement toast -->
    <div class="achievement-toast" id="achievementToast" aria-live="polite" aria-atomic="true">
        <span class="ach-icon" aria-hidden="true">&#127942;</span>
        <div class="ach-body">
            <span class="ach-label">Achievement Unlocked</span>
            <span class="ach-title" id="achTitle"></span>
        </div>
    </div>

    <div class="share-toast" id="shareToast" aria-live="polite" aria-atomic="true">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <!-- Screen reader announcement region -->
    <div id="srAnnounce" aria-live="assertive" aria-atomic="true" role="alert" style="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;"></div>

    <script>
        // ─── Themed Prompt Pools ───
        const themes = {
            classic: {
                name: 'Classic',
                prompts: [
            "Knows how to read tarot", "Knows sign language", "Appeared in a movie", "Met a celebrity",
            "Went viral online", "Owns a gaming computer", "Knows how to surf", "Has an unusual family tradition",
            "Loves true crime podcasts", "Likes pineapple on pizza", "Proposed to spouse in public", "Loves roller coasters",
            "Does Yoga", "Can do a cartwheel", "Rides horses", "Knows martial arts", "Started a club", "Attended a concert this year",
            "Has been to the Olympics", "Has a pen pal", "Has been on a reality show", "Spelling bee champ", "Has been on a road trip",
            "Sends holiday cards", "Screams during scary movies", "Loves karaoke", "Was lead in a play", "Can hula hoop",
            "Can bench press 150+ lbs", "Good at escape rooms", "Has been skydiving", "Won an eating competition", "Wearing funny socks",
            "Won at a casino", "Never flown on an airplane", "Never learned to ride a bike", "Collects something",
            "Goes all-out on holiday decorating", "Recently handmade a gift", "Received an award", "Has performed in public", "Has a phobia",
            "Has a BFF from high school", "Currently a student", "Took a how-to class recently", "Listens to podcasts",
            "Travels often", "Attended high school reunion", "Has food allergies", "Belongs to a club", "Named after a relative",
            "Has a scar", "Has broken a bone", "Has a nickname", "Birthday is on a holiday", "Has a bucket list",
            "Makes New Year's resolutions", "Good cook", "Taught a class", "Had a secret admirer", "Helped a stranger",
            "Got help from a stranger", "Worked at a family business", "Visited 4+ continents", "Took dance lessons", "Speaks 2+ languages",
            "Can code", "Won a contest", "Gardens", "Traveled in the last year", "Can bake a cake from scratch",
            "Knows the whole periodic table", "Can do basic car repairs", "Was in a wedding party this year", "Owns crypto",
            "Invests in the stock market", "Climbed a mountain", "Moved in the past year", "Owns a boat", "Has a big backyard",
            "Digital nomad", "Notary public", "Lives near a coffee shop", "Lives in a rural area", "Can drive manual transmission",
            "Reads newspapers", "Does stand up comedy", "Owns a vacation house", "Started a business", "Firefighter or EMT",
            "Has been in a hot air balloon", "Has taken a cruise", "Won a race", "Ran in a marathon", "Has a side hustle",
            "Regularly writes reviews", "Watches documentaries", "Knows calligraphy", "Brews beer", "Built an app", "Mixologist",
            "Prefers remote work", "Prefers working in office", "Has a snack stash", "Drinks 3+ cups coffee a day",
            "Has worked here 3+ years", "Has worked in another industry", "Has a work music playlist", "Has a favorite pen",
            "Has a messy desk", "Has 0 unread emails", "Prefers working in the morning", "Prefers working at night",
            "Has worked here 2+ years", "Has worked here <1 year", "Has had an 1hr+ commute", "Manager", "Runs errands during lunch break",
            "Buys coffee every morning", "Buys lunch every day", "Played prank on a coworker", "Works out before work",
            "Works out after work", "Has received a Shout Out", "Worked for a rival company", "Mentor", "Attends networking events",
            "Part of a professional group", "Organized a work outing", "Going on vacation soon", "Was promoted this year",
            "Switched departments this year", "Good at interviews", "Bad at interviews", "Hired an employee", "Led a project",
            "Planned a work party", "Only child", "Twin or triplet", "Comes from a big family", "Military family", "Parent",
            "Grandparent", "Lived in another country", "Hand-made an outfit", "In a sports league", "Plays an instrument",
            "Volunteers regularly", "Read 10+ books this year", "Wears contacts", "Has a cat", "Has a dog", "Has an exotic pet",
            "Runs regularly", "Has an unusual hobby", "Lives with roommates", "Has a tattoo", "Is left-handed", "Has officiated a wedding",
            "Has been scuba diving", "Double-jointed", "Uses a paper planner", "Vegetarian", "Introvert", "Extrovert", "Creates art",
            "Enjoys meeting new people", "Met partner through online dating", "Writer", "Got engaged this year", "Got married this year",
            "Bought a house this year", "Bought a car this year", "Had a baby this year", "Became debt-free this year",
            "Quit a bad habit recently", "Has a Masters or PhD", "Has a sweet tooth", "Has a hidden talent", "Child of immigrants",

            // ── Additional prompts ──
            "Has visited all 50 states", "Has been to Disneyland or Disney World", "Has traveled solo internationally",
            "Has slept in an airport", "Has gone white water rafting", "Has been zip-lining", "Has been bungee jumping",
            "Went camping recently", "Has been on a safari", "Has ridden a camel", "Has been to a volcano",
            "Traveled by train across a country", "Has taken a helicopter ride", "Has seen the Northern Lights",
            "Has gone parasailing", "Has been to a drive-in movie", "Has been to a theme park this year",
            "Can cook a dish from another culture", "Has eaten an insect", "Has gone wine tasting",
            "Makes their own pasta", "Has a signature dish", "Has tried durian", "Drinks tea every day",
            "Loves spicy food", "Can make sushi", "Keeps a sourdough starter", "Has tried escargot",
            "Has eaten at a Michelin-star restaurant", "Owns a cast-iron skillet", "Prefers tea over coffee",
            "Always orders the same thing at restaurants", "Can juggle", "Can solve a Rubik's cube",
            "Can whistle with fingers", "Knows CPR", "Can change a flat tire", "Can type 80+ WPM",
            "Can do a headstand", "Knows origami", "Can do magic tricks", "Knows how to sew",
            "Has won a trivia night", "Can parallel park on the first try", "Can fold a fitted sheet",
            "Can do an impression of a celebrity", "Can name all the planets in order", "Can name all the zodiac signs",
            "Plays board games weekly", "Has completed a 1000+ piece puzzle", "Plays video games daily",
            "Collects vinyl records", "Watches anime", "Has seen a Broadway show", "Loves bird watching",
            "Does crossword puzzles", "Plays chess", "Has cosplayed", "Has been to Comic-Con",
            "Knits or crochets", "Does woodworking", "Has finished a coloring book", "Has been geocaching",
            "Has won a board game tournament", "Has tried axe throwing", "Has taken a pottery class",
            "Has been on TV", "Has met a world leader", "Has witnessed a natural disaster",
            "Has found a four-leaf clover", "Has had a paranormal experience", "Has been in a newspaper",
            "Has caught a foul ball at a game", "Has been a camp counselor", "Has been a lifeguard",
            "Has donated blood 5+ times", "Has done jury duty", "Has been stuck in an elevator",
            "Has won a costume contest", "Has written a love letter", "Has been in a flash mob",
            "Has a secret recipe", "Has swum with dolphins", "Has been whale watching",
            "Has made their own Halloween costume", "Has pulled a prank on April Fools",
            "Has met an online friend in person", "Has a secret handshake", "Has been to a haunted house",
            "Has done a polar plunge", "Has ridden a motorcycle", "Has been to a professional championship game",
            "Has completed a tough mudder or Spartan race", "Night owl", "Early bird", "Believes in aliens",
            "Has a lucky number", "Meditates regularly", "Journals daily", "Can nap anywhere",
            "Follows astrology", "Has a comfort show they rewatch", "Prefers books over movies",
            "Loves thunderstorms", "Is always cold", "Sleeps with a fan on", "Wakes up without an alarm",
            "Has a morning routine over 1 hour", "Has binge-watched a series in a weekend",
            "Has a go-to dad joke", "Has dyed their hair an unusual color", "Has lived in 3+ states",
            "Has a library card", "Knows their Myers-Briggs type", "Has a favorite conspiracy theory",
            "Has a collection of magnets", "Has a dream car", "Can recite a movie scene by heart",
            "Has re-read a book 3+ times", "Owns 20+ pairs of shoes", "Has a lucky charm",
            "Has given a talk to 100+ people", "Has worked in food service", "Has worked in retail",
            "Has worked a night shift", "Has been on a business trip abroad", "Has a professional certification",
            "Has taught someone to drive", "Studied abroad", "Changed careers",
            "Has pulled an all-nighter for work", "Brings lunch to work every day",
            "Has a smart home device", "Uses dark mode on everything", "Has built a PC",
            "Has a TikTok account", "Has 1000+ followers on social media", "Has a YouTube channel",
            "Listens to ASMR", "Has a 3D printer", "Remembers life before smartphones",
            "Has a mechanical keyboard", "Prefers Android over iPhone", "Prefers iPhone over Android",
            "Has a drone", "Has a fitness tracker", "Has a standing desk",
            "Has an indoor plant collection", "Has built something from IKEA without instructions",
            "Has completed a triathlon", "Can do 50+ push-ups", "Has been rock climbing",
            "Plays pickleball", "Goes snowboarding", "Has been ice skating this year",
            "Has bowled a 200+ game", "Has a black belt", "Plays golf", "Has won a sports trophy",
            "Swims regularly", "Cycles to work or school", "Has taken a self-defense class",
            "Has been a best man or maid of honor", "Married their high school sweetheart",
            "Adopted a pet from a shelter", "Is a godparent", "Has hosted a foreign exchange student",
            "Knows family tree 4+ generations back", "Named a pet after a celebrity",
            "Has fostered an animal", "Has been to a comedy show", "Has been to a farmers market this month",
            "Composts at home", "Has a very specific morning coffee order", "Has a pen name or alias"
                ]
            },
            work: {
                name: 'Work',
                prompts: [
                    "Has worked here 3+ years", "Has worked here 2+ years", "Has worked here <1 year",
                    "Has had an 1hr+ commute", "Manager", "Runs errands during lunch break",
                    "Buys coffee every morning", "Buys lunch every day", "Played prank on a coworker",
                    "Works out before work", "Works out after work", "Has received a Shout Out",
                    "Worked for a rival company", "Mentor to a colleague", "Attends networking events",
                    "Part of a professional group", "Organized a work outing", "Going on vacation soon",
                    "Was promoted this year", "Switched departments this year", "Good at interviews",
                    "Bad at interviews", "Has hired an employee", "Led a cross-team project",
                    "Planned a work party", "Prefers remote work", "Prefers working in office",
                    "Has a snack stash at their desk", "Drinks 3+ cups coffee a day",
                    "Has worked in another industry", "Listens to music while working",
                    "Has a favorite pen at work", "Has a messy desk", "Has 0 unread emails",
                    "Prefers working in the morning", "Prefers working at night",
                    "Brings lunch to work every day", "Has a standing desk",
                    "Has given a talk to 100+ people", "Has a professional certification",
                    "Has pulled an all-nighter for work", "Changed careers at least once",
                    "Started a business", "Has a side hustle", "Has been on a business trip abroad",
                    "Can name every coworker on their floor", "Has a pen they refuse to lend",
                    "Worked at a family business", "Has worked in food service",
                    "Has worked in retail", "Has worked a night shift",
                    "Has a very specific coffee order", "Has taught a class or workshop",
                    "Has a Masters or PhD", "Has a professional mentor",
                    "Has attended a conference this year", "Eats lunch at their desk",
                    "Has a work best friend", "Decorates their workspace",
                    "Takes walking meetings", "Has presented to an executive"
                ]
            },
            friends: {
                name: 'Friends',
                prompts: [
                    "Knows how to read tarot", "Met a celebrity", "Went viral online",
                    "Loves true crime podcasts", "Likes pineapple on pizza", "Loves roller coasters",
                    "Attended a concert this year", "Loves karaoke", "Good at escape rooms",
                    "Has been skydiving", "Wearing funny socks right now", "Won at a casino",
                    "Never flown on an airplane", "Has a phobia", "Has a BFF from childhood",
                    "Has a nickname everyone uses", "Has a bucket list", "Good cook",
                    "Had a secret admirer", "Watches anime", "Plays video games daily",
                    "Plays board games weekly", "Has a tattoo", "Plays an instrument",
                    "Creates art", "Has a hidden talent", "Night owl", "Early bird",
                    "Can juggle", "Can solve a Rubik's cube", "Can do magic tricks",
                    "Has dyed their hair an unusual color", "Has a comfort show they rewatch",
                    "Believes in aliens", "Follows astrology", "Has a go-to dad joke",
                    "Can do an impression of a celebrity", "Has a lucky charm",
                    "Has a dream car", "Has a secret handshake", "Collects something weird",
                    "Has been to a haunted house", "Has done a polar plunge",
                    "Has pulled a prank on April Fools", "Has been in a flash mob",
                    "Has cosplayed", "Has been to Comic-Con", "Knows all the lyrics to a 90s hit",
                    "Can recite a movie scene by heart", "Has won a costume contest",
                    "Has met an online friend in person", "Still has a childhood stuffed animal",
                    "Has a group chat that never stops", "Owns a matching friendship bracelet",
                    "Has crashed a party", "Always picks dare in truth or dare",
                    "Has stayed up all night talking", "Always late to hang outs",
                    "Always the one who plans the hang out", "Sends memes daily"
                ]
            },
            family: {
                name: 'Family',
                prompts: [
                    "Only child", "Twin or triplet", "Comes from a big family (4+ siblings)",
                    "Military family", "Parent", "Grandparent", "Named after a relative",
                    "Child of immigrants", "Has an unusual family tradition",
                    "Goes all-out on holiday decorating", "Sends holiday cards every year",
                    "Has a family group chat", "Family has a signature recipe passed down",
                    "Married their high school sweetheart", "Has a family pet",
                    "Adopted a pet from a shelter", "Is a godparent",
                    "Has hosted a foreign exchange student", "Knows family tree 4+ generations back",
                    "Named a pet after a family member", "Has fostered an animal",
                    "Has officiated a family wedding", "Has been a best man or maid of honor",
                    "Got engaged this year", "Got married this year", "Bought a house this year",
                    "Had a baby this year", "Proposed to spouse in public",
                    "Has a big backyard", "Gardens with family", "Cooks Sunday dinner",
                    "Family game night at least once a month", "Has a family movie tradition",
                    "Has made matching Halloween costumes with family", "Takes an annual family photo",
                    "Has a family vacation spot they return to", "Has lived in 3+ states with family",
                    "Oldest sibling", "Youngest sibling", "Middle child",
                    "Has a relative who is famous", "Looks just like a parent",
                    "Inherited a family heirloom", "Family has a funny inside joke",
                    "Has a family recipe that's a secret", "Cooks a holiday meal from scratch",
                    "Family does a gift exchange", "Keeps a sourdough starter from a relative",
                    "Has hosted a family reunion", "Family has matching pajamas",
                    "Has a parent who embarrasses them lovingly", "Teaches a family member a skill",
                    "Has a family pet with a funny name", "Has a family text chain",
                    "Has a sibling they talk to every day", "Has lived with a grandparent",
                    "Family has a unique holiday tradition", "Has a family photo wall at home",
                    "Family cooks together on weekends", "Has passed down a tradition to a child"
                ]
            },
            dating: {
                name: 'First Date',
                prompts: [
                    "Loves roller coasters", "Does Yoga", "Knows how to surf",
                    "Loves true crime podcasts", "Likes pineapple on pizza", "Loves karaoke",
                    "Good at escape rooms", "Has a hidden talent", "Has a sweet tooth",
                    "Has a bucket list", "Good cook", "Speaks 2+ languages",
                    "Can bake a cake from scratch", "Plays an instrument", "Creates art",
                    "Has a nickname", "Has been skydiving", "Has been scuba diving",
                    "Watches documentaries", "Listens to podcasts", "Loves to travel",
                    "Has taken a cruise", "Climbed a mountain", "Night owl", "Early bird",
                    "Loves spicy food", "Prefers tea over coffee", "Watches anime",
                    "Has an unusual hobby", "Vegetarian", "Has a dog", "Has a cat",
                    "Prefers books over movies", "Has a comfort show they rewatch",
                    "Follows astrology", "Believes in aliens", "Loves thunderstorms",
                    "Can make sushi", "Has gone wine tasting", "Has seen a Broadway show",
                    "Meditates regularly", "Loves hiking", "Loves the beach",
                    "Prefers mountains over ocean", "Loves cooking for others",
                    "Has a favorite hole-in-the-wall restaurant", "Spontaneous traveler",
                    "Loves farmers markets", "Has a morning routine", "Journals regularly",
                    "Loves board game cafes", "Loves live music", "Has a favorite local park",
                    "Enjoys picnics", "Loves trying new cuisines", "Collects vinyl records",
                    "Has a go-to karaoke song", "Loves thrift shopping",
                    "Prefers small gatherings over big parties", "Has a green thumb",
                    "Loves stargazing", "Would rather cook than order in"
                ]
            }
        };

        // ─── Game State ───
        let currentTheme = localStorage.getItem('ib_theme') || 'classic';
        let isDailyMode = localStorage.getItem('ib_daily') === 'true';
        let shuffled = [];
        let currentSeed = null;
        const grid = document.getElementById('gridContainer');
        const cells = Array(25).fill(false);
        const winningPatterns = [
            [0, 1, 2, 3, 4], [5, 6, 7, 8, 9], [10, 11, 12, 13, 14],
            [15, 16, 17, 18, 19], [20, 21, 22, 23, 24],
            [0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22],
            [3, 8, 13, 18, 23], [4, 9, 14, 19, 24],
            [0, 6, 12, 18, 24], [4, 8, 12, 16, 20]
        ];
        const completedPatterns = new Set();
        let wins = 0;
        const hitMilestones = new Set();

        // ─── Personality Titles ───
        const titleTiers = [
            [0, 'Wallflower'],
            [6, 'Getting Warmed Up'],
            [11, 'Social Butterfly'],
            [16, 'Life of the Party'],
            [21, 'Certified Icebreaker']
        ];
        let currentTitle = '';
        let suppressTitleToast = true;

        function getTitle(checked) {
            let title = titleTiers[0][1];
            for (const [min, name] of titleTiers) {
                if (checked >= min) title = name;
            }
            return title;
        }

        // ─── Seeded Shuffle (for daily/challenge) ───
        function seededRandom(seed) {
            let s = seed;
            return function () {
                s = (s * 16807 + 0) % 2147483647;
                return (s - 1) / 2147483646;
            };
        }

        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash) || 1;
        }

        function shuffleArray(array, seed) {
            const arr = [...array];
            if (seed !== undefined) {
                const rng = seededRandom(seed);
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(rng() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
            } else {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
            }
            return arr;
        }

        // ─── Sound System ───
        let soundEnabled = false;
        const audioCtx = typeof AudioContext !== 'undefined' ? new AudioContext() : null;

        function playTone(freq, duration, type = 'sine', volume = 0.15) {
            if (!soundEnabled || !audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playIceCrack() {
            playTone(1800, 0.08, 'square', 0.06);
            setTimeout(() => playTone(2400, 0.06, 'square', 0.04), 30);
            setTimeout(() => playTone(1200, 0.1, 'triangle', 0.05), 60);
        }

        function playUncheck() {
            playTone(600, 0.1, 'sine', 0.06);
        }

        function playBingoChime() {
            const notes = [523, 659, 784, 1047];
            notes.forEach((f, i) => setTimeout(() => playTone(f, 0.3, 'sine', 0.12), i * 100));
        }

        function playMilestoneChime() {
            playTone(784, 0.15, 'sine', 0.1);
            setTimeout(() => playTone(988, 0.2, 'sine', 0.1), 80);
        }

        document.getElementById('soundToggle').addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').classList.toggle('active', soundEnabled);
            if (soundEnabled && audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        });

        // Respect prefers-reduced-motion
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            soundEnabled = false;
        }

        // ─── Visual Theme Config ───
        const visualThemes = {
            classic: {
                symbols: ['\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2745', '\u2746', '\u2744', '\u2728', '\u2B50', '\u2728', '\u2B50'],
                colors: [
                    ['rgba(255,255,255,0.35)','rgba(200,230,255,0.30)','rgba(255,255,255,0.28)','rgba(200,230,255,0.32)','rgba(255,255,255,0.30)'],
                    ['rgba(255,255,255,0.25)','rgba(186,220,248,0.22)','rgba(255,255,255,0.20)','rgba(200,230,255,0.24)','rgba(255,255,255,0.22)','rgba(186,220,248,0.26)','rgba(255,255,255,0.20)','rgba(200,230,255,0.23)'],
                    ['rgba(255,255,255,0.14)','rgba(255,255,255,0.12)','rgba(200,230,255,0.16)','rgba(255,255,255,0.13)','rgba(255,255,255,0.15)','rgba(200,230,255,0.14)','rgba(255,255,255,0.12)','rgba(255,255,255,0.16)','rgba(200,230,255,0.13)'],
                    ['rgba(56,189,248,0.20)','rgba(139,92,246,0.18)','rgba(56,189,248,0.22)','rgba(167,139,250,0.18)']
                ],
                starGrad: ['#fde68a','#f59e0b','#b45309'],
                starDrop: 'rgba(120,53,15,0.5)'
            },
            work: {
                symbols: ['\u25C6', '\u25A0', '\u25CF', '\u25B2', '\u25C7', '\u25C6', '\u25A0', '\u25CF', '\u25B2', '\u25C7', '\u25C6', '\u25A0', '\u25CF', '\u25C7', '\u25A0', '\u25CF', '\u25B2', '\u25C6', '\u25C7', '\u25A0', '\u25CF', '\u25B2', '\u2726', '\u2605', '\u2726', '\u2605'],
                colors: [
                    ['rgba(251,191,36,0.30)','rgba(148,163,184,0.25)','rgba(251,146,60,0.28)','rgba(148,163,184,0.30)','rgba(251,191,36,0.25)'],
                    ['rgba(251,191,36,0.20)','rgba(148,163,184,0.18)','rgba(251,146,60,0.16)','rgba(148,163,184,0.20)','rgba(251,191,36,0.18)','rgba(148,163,184,0.22)','rgba(251,146,60,0.16)','rgba(148,163,184,0.18)'],
                    ['rgba(251,191,36,0.12)','rgba(148,163,184,0.10)','rgba(251,146,60,0.12)','rgba(148,163,184,0.11)','rgba(251,191,36,0.10)','rgba(148,163,184,0.12)','rgba(251,146,60,0.10)','rgba(251,191,36,0.12)','rgba(148,163,184,0.10)'],
                    ['rgba(251,191,36,0.20)','rgba(251,146,60,0.18)','rgba(251,191,36,0.22)','rgba(148,163,184,0.18)']
                ],
                starGrad: ['#fde68a','#f59e0b','#92400e'],
                starDrop: 'rgba(120,53,15,0.5)'
            },
            friends: {
                symbols: ['\u2605', '\u266A', '\u2726', '\u2736', '\u2605', '\u266A', '\u2726', '\u2736', '\u2605', '\u266A', '\u2726', '\u2736', '\u2605', '\u266A', '\u2726', '\u2736', '\u2605', '\u266A', '\u2726', '\u2736', '\u2605', '\u266A', '\u2728', '\u2B50', '\u2728', '\u2B50'],
                colors: [
                    ['rgba(217,70,239,0.32)','rgba(139,92,246,0.28)','rgba(236,72,153,0.30)','rgba(6,182,212,0.28)','rgba(217,70,239,0.30)'],
                    ['rgba(217,70,239,0.22)','rgba(139,92,246,0.20)','rgba(236,72,153,0.18)','rgba(6,182,212,0.20)','rgba(217,70,239,0.18)','rgba(139,92,246,0.22)','rgba(236,72,153,0.20)','rgba(6,182,212,0.18)'],
                    ['rgba(217,70,239,0.12)','rgba(139,92,246,0.10)','rgba(236,72,153,0.12)','rgba(6,182,212,0.11)','rgba(217,70,239,0.10)','rgba(139,92,246,0.12)','rgba(236,72,153,0.10)','rgba(217,70,239,0.12)','rgba(6,182,212,0.10)'],
                    ['rgba(217,70,239,0.22)','rgba(236,72,153,0.20)','rgba(6,182,212,0.22)','rgba(139,92,246,0.20)']
                ],
                starGrad: ['#f9a8d4','#ec4899','#be185d'],
                starDrop: 'rgba(157,23,77,0.5)'
            },
            family: {
                symbols: ['\u2665', '\u2605', '\u263A', '\u2665', '\u2605', '\u2665', '\u263A', '\u2605', '\u2665', '\u2605', '\u2665', '\u263A', '\u2605', '\u2665', '\u2605', '\u263A', '\u2665', '\u2605', '\u2665', '\u263A', '\u2605', '\u2665', '\u2728', '\u2B50', '\u2728', '\u2B50'],
                colors: [
                    ['rgba(59,130,246,0.32)','rgba(234,179,8,0.30)','rgba(34,197,94,0.28)','rgba(59,130,246,0.30)','rgba(234,179,8,0.28)'],
                    ['rgba(59,130,246,0.22)','rgba(234,179,8,0.20)','rgba(34,197,94,0.18)','rgba(59,130,246,0.20)','rgba(234,179,8,0.18)','rgba(34,197,94,0.22)','rgba(59,130,246,0.20)','rgba(234,179,8,0.18)'],
                    ['rgba(59,130,246,0.12)','rgba(234,179,8,0.10)','rgba(34,197,94,0.12)','rgba(59,130,246,0.11)','rgba(234,179,8,0.10)','rgba(34,197,94,0.12)','rgba(59,130,246,0.10)','rgba(234,179,8,0.12)','rgba(34,197,94,0.10)'],
                    ['rgba(59,130,246,0.22)','rgba(234,179,8,0.20)','rgba(34,197,94,0.22)','rgba(59,130,246,0.20)']
                ],
                starGrad: ['#fde68a','#eab308','#a16207'],
                starDrop: 'rgba(133,77,14,0.5)'
            },
            dating: {
                symbols: ['\u2661', '\u2728', '\u2605', '\u2661', '\u2728', '\u2661', '\u2728', '\u2605', '\u2661', '\u2728', '\u2661', '\u2605', '\u2728', '\u2661', '\u2728', '\u2605', '\u2661', '\u2728', '\u2661', '\u2605', '\u2728', '\u2661', '\u2728', '\u2B50', '\u2728', '\u2B50'],
                colors: [
                    ['rgba(244,114,182,0.32)','rgba(232,121,249,0.28)','rgba(251,191,36,0.25)','rgba(244,114,182,0.30)','rgba(232,121,249,0.28)'],
                    ['rgba(244,114,182,0.22)','rgba(232,121,249,0.20)','rgba(251,191,36,0.16)','rgba(244,114,182,0.20)','rgba(232,121,249,0.18)','rgba(244,114,182,0.22)','rgba(251,191,36,0.16)','rgba(232,121,249,0.18)'],
                    ['rgba(244,114,182,0.12)','rgba(232,121,249,0.10)','rgba(251,191,36,0.10)','rgba(244,114,182,0.11)','rgba(232,121,249,0.10)','rgba(244,114,182,0.12)','rgba(251,191,36,0.10)','rgba(244,114,182,0.12)','rgba(232,121,249,0.10)'],
                    ['rgba(244,114,182,0.22)','rgba(232,121,249,0.20)','rgba(251,191,36,0.18)','rgba(244,114,182,0.20)']
                ],
                starGrad: ['#fecdd3','#f472b6','#db2777'],
                starDrop: 'rgba(157,23,77,0.5)'
            }
        };

        // Particle layer layout (matches the original snowflake structure)
        const particleLayout = [
            // Layer 1: large foreground (5)
            { left: '3%',  size: '1.8rem', fall: 14, sway: 4,  delay: 0,  swayD: 0 },
            { left: '22%', size: '1.6rem', fall: 16, sway: 5,  delay: 2,  swayD: 1 },
            { left: '48%', size: '2.0rem', fall: 13, sway: 3.5,delay: 5,  swayD: 0.5 },
            { left: '70%', size: '1.7rem', fall: 15, sway: 4.5,delay: 1,  swayD: 2 },
            { left: '90%', size: '1.5rem', fall: 17, sway: 5.5,delay: 8,  swayD: 0 },
            // Layer 2: medium mid-ground (8)
            { left: '8%',  size: '1.1rem', fall: 20, sway: 5,  delay: 3,  swayD: 1.5 },
            { left: '18%', size: '1.3rem', fall: 18, sway: 6,  delay: 0,  swayD: 3 },
            { left: '32%', size: '1.0rem', fall: 22, sway: 4.5,delay: 6,  swayD: 0 },
            { left: '45%', size: '1.2rem', fall: 19, sway: 5.5,delay: 10, swayD: 2 },
            { left: '58%', size: '1.1rem', fall: 21, sway: 6.5,delay: 4,  swayD: 1 },
            { left: '72%', size: '1.4rem', fall: 17, sway: 4,  delay: 7,  swayD: 0.5 },
            { left: '83%', size: '1.0rem', fall: 23, sway: 5,  delay: 1,  swayD: 2.5 },
            { left: '95%', size: '1.3rem', fall: 20, sway: 5.5,delay: 9,  swayD: 0 },
            // Layer 3: small background (9)
            { left: '6%',  size: '0.6rem', fall: 12, sway: 3,  delay: 2,  swayD: 0,   blur: 1 },
            { left: '14%', size: '0.5rem', fall: 10, sway: 3.5,delay: 0,  swayD: 1,   blur: 1 },
            { left: '25%', size: '0.7rem', fall: 11, sway: 2.5,delay: 4,  swayD: 0.5, blur: 1 },
            { left: '38%', size: '0.5rem', fall: 13, sway: 4,  delay: 6,  swayD: 2,   blur: 1.5 },
            { left: '52%', size: '0.6rem', fall: 9,  sway: 3,  delay: 1,  swayD: 0,   blur: 1 },
            { left: '63%', size: '0.7rem', fall: 12, sway: 3.5,delay: 8,  swayD: 1.5, blur: 1 },
            { left: '76%', size: '0.5rem', fall: 10, sway: 2.5,delay: 3,  swayD: 0,   blur: 1.5 },
            { left: '85%', size: '0.6rem', fall: 11, sway: 4,  delay: 5,  swayD: 1,   blur: 1 },
            { left: '96%', size: '0.5rem', fall: 14, sway: 3,  delay: 7,  swayD: 2.5, blur: 1 },
            // Layer 4: sparkles (4)
            { left: '10%', size: '0.9rem', fall: 16, sway: 5,  delay: 0,  swayD: 0.5, sparkle: 2 },
            { left: '40%', size: '0.8rem', fall: 19, sway: 4,  delay: 3,  swayD: 1,   sparkle: 2.5 },
            { left: '65%', size: '1.0rem', fall: 14, sway: 5.5,delay: 6,  swayD: 0,   sparkle: 1.8 },
            { left: '88%', size: '0.7rem', fall: 21, sway: 4.5,delay: 9,  swayD: 2,   sparkle: 2.2 }
        ];

        function buildParticles(themeKey) {
            const container = document.getElementById('particleContainer');
            container.innerHTML = '';
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const cfg = visualThemes[themeKey] || visualThemes.classic;
            const allColors = [...cfg.colors[0], ...cfg.colors[1], ...cfg.colors[2], ...cfg.colors[3]];

            particleLayout.forEach((p, i) => {
                const el = document.createElement('div');
                el.className = 'snowflake';
                el.textContent = cfg.symbols[i] || cfg.symbols[0];
                el.style.left = p.left;
                el.style.fontSize = p.size;
                el.style.color = allColors[i] || allColors[0];
                if (p.blur) el.style.filter = `blur(${p.blur}px)`;

                if (p.sparkle) {
                    el.style.animation = `snowfall ${p.fall}s linear infinite, snowsway ${p.sway}s ease-in-out infinite, sparkle ${p.sparkle}s ease-in-out infinite`;
                    el.style.animationDelay = `${p.delay}s, ${p.swayD}s, 0s`;
                } else {
                    el.style.animationDuration = `${p.fall}s, ${p.sway}s`;
                    el.style.animationDelay = `${p.delay}s, ${p.swayD}s`;
                }
                container.appendChild(el);
            });
        }

        function applyVisualTheme(themeKey) {
            document.body.dataset.visualTheme = themeKey;
            buildParticles(themeKey);
        }

        // ─── Theme Picker ───
        function buildThemePicker() {
            const picker = document.getElementById('themePicker');
            picker.innerHTML = '';
            for (const [key, theme] of Object.entries(themes)) {
                const btn = document.createElement('button');
                btn.className = 'theme-btn' + (key === currentTheme ? ' active' : '');
                btn.textContent = theme.name;
                btn.dataset.theme = key;
                btn.addEventListener('click', () => selectTheme(key));
                picker.appendChild(btn);
            }
            // Daily challenge button
            const dailyBtn = document.createElement('button');
            dailyBtn.className = 'theme-btn' + (isDailyMode ? ' active' : '');
            dailyBtn.innerHTML = 'Daily<span class="daily-badge">NEW</span>';
            dailyBtn.id = 'dailyBtn';
            dailyBtn.addEventListener('click', toggleDailyMode);
            picker.appendChild(dailyBtn);
        }

        function selectTheme(key) {
            if (isDailyMode) {
                isDailyMode = false;
                localStorage.setItem('ib_daily', 'false');
            }
            currentTheme = key;
            localStorage.setItem('ib_theme', key);
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.theme-btn[data-theme="${key}"]`)?.classList.add('active');
            document.getElementById('dailyBtn')?.classList.remove('active');
            document.getElementById('resetBtn').disabled = false;
            applyVisualTheme(key);
            resetBoard();
        }

        function toggleDailyMode() {
            isDailyMode = !isDailyMode;
            localStorage.setItem('ib_daily', isDailyMode ? 'true' : 'false');
            document.getElementById('dailyBtn')?.classList.toggle('active', isDailyMode);
            if (isDailyMode) {
                document.querySelectorAll('.theme-btn[data-theme]').forEach(b => b.classList.remove('active'));
                document.getElementById('resetBtn').disabled = true;
            } else {
                document.querySelector(`.theme-btn[data-theme="${currentTheme}"]`)?.classList.add('active');
                document.getElementById('resetBtn').disabled = false;
            }
            resetBoard();
        }

        // ─── Daily Board ───
        function getDailySeed() {
            const today = new Date().toISOString().slice(0, 10);
            return hashString(today + '_' + currentTheme);
        }

        function loadDailyProgress() {
            const today = new Date().toISOString().slice(0, 10);
            const key = `ib_daily_${today}_${currentTheme}`;
            const saved = localStorage.getItem(key);
            if (saved) {
                try {
                    const arr = JSON.parse(saved);
                    arr.forEach((v, i) => { cells[i] = v; });
                    return true;
                } catch (e) { /* ignore */ }
            }
            return false;
        }

        function saveDailyProgress() {
            if (!isDailyMode) return;
            const today = new Date().toISOString().slice(0, 10);
            const key = `ib_daily_${today}_${currentTheme}`;
            localStorage.setItem(key, JSON.stringify(cells));
        }

        // ─── Board Setup ───
        function getPrompts() {
            return themes[currentTheme]?.prompts || themes.classic.prompts;
        }

        function initBoard() {
            const prompts = getPrompts();
            if (isDailyMode) {
                currentSeed = getDailySeed();
                shuffled = shuffleArray(prompts, currentSeed).slice(0, 24);
            } else if (currentSeed !== null && !isDailyMode) {
                // Challenge link mode
                shuffled = shuffleArray(prompts, currentSeed).slice(0, 24);
            } else {
                currentSeed = Math.floor(Math.random() * 2147483646) + 1;
                shuffled = shuffleArray(prompts, currentSeed).slice(0, 24);
            }
        }

        function createGrid() {
            let index = 0;
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('label');
                    cell.className = 'grid-cell';
                    cell.setAttribute('role', 'gridcell');

                    if (row === 2 && col === 2) {
                        cell.classList.add('center-cell');
                        const sg = (visualThemes[currentTheme] || visualThemes.classic).starGrad;
                        const sd = (visualThemes[currentTheme] || visualThemes.classic).starDrop;
                        cell.innerHTML = `
                            <svg class="star-3d" viewBox="0 0 24 24" aria-hidden="true" focusable="false" style="filter: drop-shadow(0 3px 4px ${sd})">
                                <defs>
                                    <linearGradient id="goldGradient" x1="0" y1="0" x2="1" y2="1">
                                        <stop offset="0%" stop-color="${sg[0]}"/>
                                        <stop offset="40%" stop-color="${sg[1]}"/>
                                        <stop offset="100%" stop-color="${sg[2]}"/>
                                    </linearGradient>
                                    <linearGradient id="goldHighlight" x1="0" y1="0" x2="0.5" y2="1">
                                        <stop offset="0%" stop-color="#ffffff"/>
                                        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                                <path class="star-base" d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/>
                                <path class="star-highlight" d="M12 2L14.81 8.63L22 9.24L16.54 13.97L18.18 21L12 17.27L5.82 21L7.46 13.97L2 9.24L9.19 8.63L12 2Z" clip-path="polygon(0 0, 100% 0, 40% 60%)"/>
                            </svg>
                        `;
                        cell.setAttribute('aria-label', 'Free space, always checked');
                        cells[row * 5 + col] = true;
                    } else {
                        const promptText = shuffled[index];
                        const isChecked = cells[row * 5 + col];
                        cell.innerHTML = `
                            <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleCell(${row}, ${col})" aria-label="${promptText}">
                            <span>${promptText}</span>
                        `;
                        index++;
                    }
                    grid.appendChild(cell);
                }
            }
            updateStats();
            // Re-check wins for restored daily boards
            if (isDailyMode) {
                for (const [pi, pattern] of winningPatterns.entries()) {
                    if (pattern.every(i => cells[i]) && !completedPatterns.has(pi)) {
                        completedPatterns.add(pi);
                        wins++;
                    }
                }
                document.getElementById('winsCount').textContent = wins;
            }
        }

        function toggleCell(row, col) {
            const index = row * 5 + col;
            cells[index] = !cells[index];
            if (cells[index]) {
                playIceCrack();
                spawnIceShards(index);
            } else {
                playUncheck();
            }
            updateStats();
            checkWins();
            checkBlackout();
            saveDailyProgress();
        }

        /** Burst ice shard particles outward from a cell */
        function spawnIceShards(cellIndex) {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
            const cellEl = grid.children[cellIndex];
            if (!cellEl) return;
            const rect = cellEl.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            const shardCount = 10;
            for (let i = 0; i < shardCount; i++) {
                const shard = document.createElement('div');
                shard.className = 'ice-shard';
                shard.setAttribute('aria-hidden', 'true');
                const angle = (i / shardCount) * 360 + (Math.random() * 30 - 15);
                const distance = 35 + Math.random() * 55;
                const rad = angle * Math.PI / 180;
                const size = 5 + Math.random() * 9;
                shard.style.left = (cx - size / 2) + 'px';
                shard.style.top = (cy - size / 2) + 'px';
                shard.style.width = size + 'px';
                shard.style.height = (size * 1.3) + 'px';
                shard.style.setProperty('--shard-dx', (Math.cos(rad) * distance) + 'px');
                shard.style.setProperty('--shard-dy', (Math.sin(rad) * distance) + 'px');
                shard.style.setProperty('--shard-rot', (Math.random() * 540 - 270) + 'deg');
                shard.style.animationDelay = (Math.random() * 0.08) + 's';
                document.body.appendChild(shard);
                shard.addEventListener('animationend', () => shard.remove());
            }
        }

        function updateStats() {
            const checked = cells.filter(Boolean).length;
            document.getElementById('checkedCount').textContent = checked;

            // Update personality title — show as achievement toast
            const newTitle = getTitle(checked);
            if (newTitle !== currentTitle) {
                const wasEmpty = currentTitle === '';
                currentTitle = newTitle;
                if (!suppressTitleToast && !wasEmpty) {
                    showAchievementToast(currentTitle);
                }
            }

            // Milestone confetti
            const milestones = [10, 15, 20];
            for (const m of milestones) {
                if (checked >= m && !hitMilestones.has(m)) {
                    hitMilestones.add(m);
                    playMilestoneChime();
                    createParticles(20);
                    const msgs = { 10: '10 down! Keep going!', 15: '15! You\'re on fire!', 20: '20! Almost there!' };
                    showToast('\u2728', msgs[m], 2500);
                }
            }
        }

        function checkWins() {
            for (const [patternIndex, pattern] of winningPatterns.entries()) {
                if (pattern.every(i => cells[i]) && !completedPatterns.has(patternIndex)) {
                    completedPatterns.add(patternIndex);
                    wins++;
                    // Update best streak in localStorage
                    const best = parseInt(localStorage.getItem('ib_bestBingos') || '0', 10);
                    if (wins > best) localStorage.setItem('ib_bestBingos', wins);

                    document.getElementById('winsCount').textContent = wins;
                    playBingoChime();
                    showOverlay();
                    createParticles(50);
                    break;
                }
            }
        }

        let blackoutTriggered = false;

        function checkBlackout() {
            if (blackoutTriggered) return;
            if (cells.every(Boolean)) {
                blackoutTriggered = true;
                // Close the normal bingo overlay if it's showing
                const overlay = document.getElementById('overlay');
                if (overlay.classList.contains('active')) {
                    overlay.classList.remove('active');
                    clearParticles();
                }
                // Short delay so the last bingo settles, then show blackout
                setTimeout(() => showBlackoutCelebration(), 300);
            }
        }

        function playBlackoutFanfare() {
            const notes = [523, 659, 784, 880, 1047, 1175, 1319, 1568];
            notes.forEach((f, i) => setTimeout(() => playTone(f, 0.4, 'sine', 0.14), i * 90));
            // Final chord
            setTimeout(() => {
                playTone(1047, 0.6, 'sine', 0.12);
                playTone(1319, 0.6, 'sine', 0.10);
                playTone(1568, 0.8, 'sine', 0.10);
            }, notes.length * 90);
        }

        function showBlackoutCelebration() {
            playBlackoutFanfare();
            createParticles(120);

            // Update overlay content for blackout
            document.getElementById('overlayTitle').textContent = 'BLACKOUT!';
            document.querySelector('.overlay-card .trophy').innerHTML = '&#127775;';
            document.getElementById('overlayDesc').textContent =
                'Every single square! You are the ultimate icebreaker!';

            const overlay = document.getElementById('overlay');
            overlay.classList.add('active', 'blackout');
            announce('Blackout! Every single square checked!');
            const btn = document.getElementById('newBoardBtn');
            if (btn) btn.focus();
        }

        function showOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.classList.add('active');
            announce('Bingo! You broke the ice!');
            const btn = document.getElementById('newBoardBtn');
            if (btn) btn.focus();
        }

        function closeOverlay() {
            const overlay = document.getElementById('overlay');
            const wasBlackout = overlay.classList.contains('blackout');
            overlay.classList.remove('active', 'blackout');
            clearParticles();
            // Restore normal bingo overlay text
            if (wasBlackout) {
                document.getElementById('overlayTitle').textContent = 'Bingo!';
                document.querySelector('.overlay-card .trophy').innerHTML = '&#127881;';
                document.getElementById('overlayDesc').textContent =
                    'You broke the ice! Spread the fun \u2014 share your board.';
            }
            document.getElementById('bingo-game').focus();
        }

        function announce(message) {
            const el = document.getElementById('srAnnounce');
            el.textContent = '';
            requestAnimationFrame(() => { el.textContent = message; });
        }

        function createParticles(count = 50) {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
            const shapes = ['&#10052;', '&#10053;', '&#10054;', '&#10040;', '&#9733;'];
            const colors = ['#38bdf8', '#818cf8', '#a78bfa', '#67e8f9', '#f0abfc', '#fbbf24'];
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.setAttribute('aria-hidden', 'true');
                particle.innerHTML = shapes[Math.floor(Math.random() * shapes.length)];
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.fontSize = `${Math.random() * 14 + 10}px`;
                particle.style.animationDuration = `${Math.random() * 3 + 2}s`;
                particle.style.animationDelay = `${Math.random() * 2}s`;
                document.body.appendChild(particle);
            }
        }

        function clearParticles() {
            document.querySelectorAll('.particle').forEach(p => p.remove());
        }

        // Close overlay on background click
        document.getElementById('overlay').addEventListener('click', (e) => {
            if (e.target.id === 'overlay') closeOverlay();
        });

        // Escape key closes topmost overlay (WCAG 2.1.1)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const shareOverlay = document.getElementById('shareOverlay');
                if (shareOverlay.classList.contains('active')) {
                    closeSharePanel();
                    return;
                }
                const overlay = document.getElementById('overlay');
                if (overlay.classList.contains('active')) closeOverlay();
            }
        });

        // Focus trap inside overlay dialog (WCAG 2.4.3)
        document.getElementById('overlay').addEventListener('keydown', (e) => {
            if (e.key !== 'Tab') return;
            const overlay = document.getElementById('overlay');
            if (!overlay.classList.contains('active')) return;
            const focusable = overlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusable.length === 0) return;
            const first = focusable[0];
            const last = focusable[focusable.length - 1];
            if (e.shiftKey) {
                if (document.activeElement === first) { e.preventDefault(); last.focus(); }
            } else {
                if (document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        });

        document.getElementById('newBoardBtn').addEventListener('click', closeOverlay);
        document.getElementById('resetBtn').addEventListener('click', resetBoard);
        document.getElementById('shareBtn').addEventListener('click', shareBoard);
        document.getElementById('overlayShareBtn').addEventListener('click', shareBoard);

        function resetBoard() {
            clearParticles();
            hitMilestones.clear();
            cells.fill(false);
            completedPatterns.clear();
            blackoutTriggered = false;
            // Don't reset wins — persist across boards in session
            currentTitle = '';
            suppressTitleToast = true;
            currentSeed = isDailyMode ? getDailySeed() : null;
            initBoard();
            grid.innerHTML = '';
            if (isDailyMode) {
                loadDailyProgress();
            }
            createGrid();
            suppressTitleToast = false;
        }

        // ─── Challenge Link Support ───
        function getBoardUrl() {
            if (!currentSeed) return SHARE_URL;
            let url = `${SHARE_URL}?b=${currentSeed}&t=${currentTheme}`;
            // Encode checked cells as a bitmask
            const bits = cells.map(c => c ? '1' : '0').join('');
            const packed = parseInt(bits, 2).toString(36);
            url += `&c=${packed}`;
            return url;
        }

        function loadFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const seed = params.get('b');
            const theme = params.get('t');
            const checkedParam = params.get('c');

            if (seed) {
                currentSeed = parseInt(seed, 10);
                if (theme && themes[theme]) {
                    currentTheme = theme;
                    applyVisualTheme(theme);
                }
                isDailyMode = false;
                localStorage.setItem('ib_daily', 'false');

                // Store challenger's checked cells for comparison
                if (checkedParam) {
                    const num = parseInt(checkedParam, 36);
                    const bits = num.toString(2).padStart(25, '0');
                    window._challengerCells = bits.split('').map(b => b === '1');
                }
                return true;
            }
            return false;
        }

        // ─── Comparison Mode ───
        function showComparison() {
            if (!window._challengerCells) return;
            const theirs = window._challengerCells;
            const both = [], onlyYou = [], onlyThem = [];

            for (let i = 0; i < 25; i++) {
                if (i === 12) continue; // free space
                const label = i < 12 ? shuffled[i] : shuffled[i - 1];
                if (cells[i] && theirs[i]) both.push(label);
                else if (cells[i] && !theirs[i]) onlyYou.push(label);
                else if (!cells[i] && theirs[i]) onlyThem.push(label);
            }

            // Highlight cells on the board
            const gridCells = grid.children;
            for (let i = 0; i < 25; i++) {
                const cell = gridCells[i];
                cell.style.outline = '';
                if (i === 12) continue;
                if (cells[i] && theirs[i]) {
                    cell.style.outline = '3px solid #34d399';
                } else if (!cells[i] && theirs[i]) {
                    cell.style.outline = '3px dashed #f59e0b';
                }
            }

            const msg = `You have ${both.length} thing${both.length !== 1 ? 's' : ''} in common!`;
            showToast('\u2728', msg, 5000);
            announce(msg);
        }

        // ─── Share Panel Logic ───

        function getShareText() {
            const checked = cells.filter(Boolean).length;
            const title = getTitle(checked);
            if (isDailyMode) {
                return `I'm a ${title} on today's Daily Icebreaker Bingo! How many squares can you check off?`;
            }
            return `I'm a ${title}! \uD83C\uDF89 How many squares can you check off? Try Icebreaker Bingo!`;
        }

        const SHARE_URL = 'https://icebreakerbingo.com';
        let currentImageBlob = null;

        let achToastTimeout = null;
        function showAchievementToast(title) {
            const toast = document.getElementById('achievementToast');
            const titleEl = document.getElementById('achTitle');
            titleEl.textContent = title;

            // Reset animation
            toast.classList.remove('show');
            clearTimeout(achToastTimeout);
            void toast.offsetWidth;
            toast.classList.add('show');

            achToastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3500);
        }

        function showToast(icon, message, duration = 3000) {
            const toast = document.getElementById('shareToast');
            toast.querySelector('.toast-icon').textContent = icon;
            toast.querySelector('.toast-message').textContent = message;
            toast.classList.add('show');
            clearTimeout(toast._timeout);
            toast._timeout = setTimeout(() => toast.classList.remove('show'), duration);
        }

        function openSharePanel() {
            const overlay = document.getElementById('shareOverlay');
            overlay.classList.add('active');
            overlay.setAttribute('aria-hidden', 'false');
            document.getElementById('sharePanelClose').focus();
        }

        function closeSharePanel() {
            const overlay = document.getElementById('shareOverlay');
            overlay.classList.remove('active');
            overlay.setAttribute('aria-hidden', 'true');
            const hint = document.getElementById('sharePanelHint');
            hint.classList.remove('has-image');
        }

        function setHintWave(el, text) {
            el.innerHTML = '';
            let charIndex = 0;
            for (let i = 0; i < text.length; i++) {
                const span = document.createElement('span');
                span.className = 'wave-char';
                if (text[i] === ' ') {
                    span.innerHTML = '&nbsp;';
                } else {
                    span.textContent = text[i];
                }
                span.style.animationDelay = (charIndex * 0.04) + 's';
                el.appendChild(span);
                charIndex++;
            }
        }

        async function copyImageToClipboard(blob) {
            try {
                const item = new ClipboardItem({ 'image/png': blob });
                await navigator.clipboard.write([item]);
                return true;
            } catch (err) {
                console.warn('Clipboard write failed:', err);
                return false;
            }
        }

        function downloadImage(blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'icebreaker-bingo.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function generateBoardImage() {
            const boardEl = document.querySelector('.board-frame');
            if (!boardEl || typeof html2canvas === 'undefined') return null;

            const wrapper = document.createElement('div');
            const bgDeep = getComputedStyle(document.body).getPropertyValue('--bg-deep').trim();
            const titleGlow = getComputedStyle(document.body).getPropertyValue('--title-glow').trim();

            wrapper.style.cssText = `
                position: fixed; left: -9999px; top: 0;
                background: ${bgDeep};
                padding: 32px 28px 24px;
                border-radius: 24px;
                display: flex; flex-direction: column; align-items: center; gap: 16px;
            `;

            const title = document.createElement('div');
            title.textContent = 'Icebreaker Bingo';
            title.style.cssText = `
                font-family: Fredoka, Inter, system-ui, sans-serif;
                font-size: 24px; font-weight: 700; color: #ffffff;
                text-shadow: 0 0 24px ${titleGlow};
                text-align: center;
            `;
            wrapper.appendChild(title);

            // Stats banner
            const checked = cells.filter(Boolean).length;
            const statsLine = document.createElement('div');
            statsLine.textContent = `Checked: ${checked}/24  |  Bingos: ${wins}  |  ${getTitle(checked)}`;
            statsLine.style.cssText = `
                font-family: Inter, system-ui, sans-serif;
                font-size: 12px; font-weight: 600; color: #94a3b8;
                text-align: center; letter-spacing: 0.02em;
            `;
            wrapper.appendChild(statsLine);

            const boardClone = boardEl.cloneNode(true);
            boardClone.style.background = getComputedStyle(document.body).getPropertyValue('--bg-mid').trim();
            boardClone.style.border = '1px solid rgba(255,255,255,0.10)';
            boardClone.style.maxWidth = boardEl.offsetWidth + 'px';

            const captureStyle = document.createElement('style');
            captureStyle.textContent = `.grid-cell::before, .grid-cell::after { display: none !important; }`;
            boardClone.prepend(captureStyle);

            // Read CSS variables once for theme-aware capture
            const cs = getComputedStyle(document.body);
            const cFrom = cs.getPropertyValue('--checked-from').trim();
            const cMid = cs.getPropertyValue('--checked-mid').trim();
            const cTo = cs.getPropertyValue('--checked-to').trim();
            const cSpanFrom = cs.getPropertyValue('--checked-span-from').trim();
            const cSpanTo = cs.getPropertyValue('--checked-span-to').trim();
            const cEdge = cs.getPropertyValue('--checked-edge').trim();
            const tFrom = cs.getPropertyValue('--tile-from').trim();
            const tMid = cs.getPropertyValue('--tile-mid').trim();
            const tTo = cs.getPropertyValue('--tile-to').trim();
            const tEdge = cs.getPropertyValue('--ice-edge').trim();

            boardClone.querySelectorAll('.grid-cell').forEach(cell => {
                const input = cell.querySelector('input');
                const isChecked = input && input.checked;
                const span = cell.querySelector('span');

                cell.style.backdropFilter = 'none';
                cell.style.webkitBackdropFilter = 'none';

                if (cell.classList.contains('center-cell')) return;

                if (isChecked) {
                    cell.style.background = `linear-gradient(155deg, ${cFrom} 0%, ${cMid} 50%, ${cTo} 100%)`;
                    cell.style.boxShadow = `0 4px 0 ${cEdge}, 0 6px 14px rgba(0,0,0,0.3)`;
                    if (span) {
                        span.style.background = `linear-gradient(135deg, ${cSpanFrom} 0%, ${cSpanTo} 100%)`;
                        span.style.borderRadius = '9px';
                    }
                } else {
                    cell.style.background = `linear-gradient(155deg, ${tFrom} 0%, ${tMid} 60%, ${tTo} 100%)`;
                    cell.style.boxShadow = `0 4px 0 ${tEdge}, 0 6px 14px rgba(0,0,0,0.25)`;
                    if (span) {
                        span.style.background = 'transparent';
                        span.style.boxShadow = 'none';
                    }
                }
            });

            wrapper.appendChild(boardClone);

            const cta = document.createElement('div');
            cta.textContent = 'Play at icebreakerbingo.com';
            cta.style.cssText = `
                font-family: Fredoka, Inter, system-ui, sans-serif;
                font-size: 14px; font-weight: 600; color: #94a3b8;
                text-align: center; padding-top: 2px;
            `;
            wrapper.appendChild(cta);

            document.body.appendChild(wrapper);

            try {
                const canvas = await html2canvas(wrapper, {
                    backgroundColor: bgDeep,
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                document.body.removeChild(wrapper);
                return await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
            } catch (err) {
                if (document.body.contains(wrapper)) document.body.removeChild(wrapper);
                console.error('Image generation failed:', err);
                return null;
            }
        }

        async function shareBoard() {
            // Brief loading state on share buttons
            const shareBtns = document.querySelectorAll('#shareBtn, #overlayShareBtn');
            shareBtns.forEach(btn => { btn.disabled = true; btn.style.opacity = '0.6'; });

            // Detect mobile: use native share API which handles files well
            const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

            const blob = await generateBoardImage();
            shareBtns.forEach(btn => { btn.disabled = false; btn.style.opacity = ''; });
            if (!blob) {
                showToast('\u26A0\uFE0F', 'Could not generate image');
                return;
            }

            currentImageBlob = blob;

            if (isMobile && navigator.canShare) {
                // Mobile: try native file sharing first
                try {
                    const file = new File([blob], 'icebreaker-bingo.png', { type: 'image/png' });
                    if (navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: 'Icebreaker Bingo',
                            text: getShareText()
                        });
                        return;
                    }
                } catch (err) {
                    if (err.name === 'AbortError') return;
                    // Fall through to share panel on failure
                }
            }

            // Desktop (or mobile fallback): copy to clipboard + show share panel
            const copied = await copyImageToClipboard(blob);
            const hint = document.getElementById('sharePanelHint');
            if (copied) {
                setHintWave(hint, '\u2713 Image copied to clipboard \u2014 paste it in your post!');
                hint.classList.add('has-image');
            } else {
                hint.textContent = 'Use the buttons below to share or download your board.';
                hint.classList.remove('has-image');
            }
            openSharePanel();
        }

        // Platform share handlers
        function openPlatformShare(platform) {
            const shareText = getShareText();
            const shareUrl = getBoardUrl();
            const encodedText = encodeURIComponent(shareText);
            const encodedUrl = encodeURIComponent(shareUrl);

            const urls = {
                x: `https://x.com/intent/post?text=${encodedText}&url=${encodedUrl}`,
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}`,
                whatsapp: `https://wa.me/?text=${encodedText}%20${encodedUrl}`,
                email: `mailto:?subject=${encodeURIComponent('Icebreaker Bingo')}&body=${encodedText}%0A%0A${encodedUrl}`
            };

            const url = urls[platform];
            if (url) {
                if (platform === 'email') {
                    window.location.href = url;
                } else {
                    window.open(url, '_blank', 'width=600,height=500,noopener,noreferrer');
                }
            }
        }

        // Share panel event listeners
        document.getElementById('sharePanelClose').addEventListener('click', closeSharePanel);

        document.getElementById('shareOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'shareOverlay') closeSharePanel();
        });

        document.querySelectorAll('.platform-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                openPlatformShare(btn.dataset.platform);
            });
        });

        document.getElementById('shareCopyBtn').addEventListener('click', async () => {
            if (!currentImageBlob) return;
            const copied = await copyImageToClipboard(currentImageBlob);
            if (copied) {
                showToast('\u2705', 'Image copied to clipboard!');
            } else {
                showToast('\u26A0\uFE0F', 'Copy failed — try downloading instead');
            }
        });

        document.getElementById('shareDownloadBtn').addEventListener('click', () => {
            if (!currentImageBlob) return;
            downloadImage(currentImageBlob);
            showToast('\u2B07\uFE0F', 'Image downloaded!');
        });

        document.getElementById('shareLinkBtn').addEventListener('click', async () => {
            const url = getBoardUrl();
            try {
                await navigator.clipboard.writeText(url);
                showToast('\uD83D\uDD17', 'Challenge link copied!');
            } catch (e) {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = url;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('\uD83D\uDD17', 'Challenge link copied!');
            }
        });

        // Focus trap inside share panel (WCAG 2.4.3)
        document.getElementById('shareOverlay').addEventListener('keydown', (e) => {
            if (e.key !== 'Tab') return;
            const panel = document.querySelector('.share-panel');
            const focusable = panel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusable.length === 0) return;

            const first = focusable[0];
            const last = focusable[focusable.length - 1];

            if (e.shiftKey) {
                if (document.activeElement === first) { e.preventDefault(); last.focus(); }
            } else {
                if (document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        });

        // ─── Initialization ───
        buildThemePicker();
        applyVisualTheme(currentTheme);

        // Check for challenge link in URL
        const fromUrl = loadFromUrl();
        if (!fromUrl) {
            initBoard();
            if (isDailyMode) loadDailyProgress();
        } else {
            initBoard();
        }

        createGrid();
        document.getElementById('winsCount').textContent = wins;
        suppressTitleToast = false;

        // Show compare button if this is a challenge link with opponent data
        if (window._challengerCells) {
            const compareBtn = document.createElement('button');
            compareBtn.className = 'reset-btn';
            compareBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Compare
            `;
            compareBtn.addEventListener('click', showComparison);
            document.querySelector('.board-actions').appendChild(compareBtn);
        }
    </script>
</body>
</html>
